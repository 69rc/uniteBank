{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/shared/schema.ts"],"sourcesContent":["import { pgTable, text, serial, integer, boolean, timestamp, numeric, varchar, date } from \"drizzle-orm/pg-core\";\nimport { createInsertSchema } from \"drizzle-zod\";\nimport { z } from \"zod\";\n\nexport const users = pgTable(\"users\", {\n  id: serial(\"id\").primaryKey(),\n  firstName: text(\"first_name\").notNull(),\n  lastName: text(\"last_name\").notNull(),\n  otherName: text(\"other_name\"),\n  email: text(\"email\").notNull().unique(),\n  phone: text(\"phone\").notNull(),\n  dob: date(\"dob\").notNull(),\n  gender: text(\"gender\").notNull(),\n  nationality: text(\"nationality\").notNull(),\n  \n  // Contact info\n  address: text(\"address\").notNull(),\n  city: text(\"city\").notNull(),\n  state: text(\"state\").notNull(),\n  country: text(\"country\").notNull(),\n  zipCode: text(\"zip_code\").notNull(),\n  \n  // KYC\n  idType: text(\"id_type\").notNull(), // National ID, Passport, etc.\n  idNumber: text(\"id_number\").notNull(),\n  idExpiryDate: date(\"id_expiry_date\").notNull(),\n  idImageUrl: text(\"id_image_url\"),\n  selfieUrl: text(\"selfie_url\"),\n  \n  // Account Info\n  accountType: text(\"account_type\", { enum: [\"SAVINGS\", \"CURRENT\", \"CHECKING\"] }).notNull(),\n  currency: text(\"currency\").default(\"USD\").notNull(),\n  accountPurpose: text(\"account_purpose\"),\n  \n  // Security\n  password: text(\"password\").notNull(),\n  transactionPin: text(\"transaction_pin\").notNull(), // 4-6 digits\n  \n  // Status & Role\n  role: text(\"role\", { enum: [\"USER\", \"ADMIN\"] }).default(\"USER\").notNull(),\n  status: text(\"status\", { enum: [\"PENDING\", \"APPROVED\", \"REJECTED\"] }).default(\"PENDING\").notNull(),\n  isEmailVerified: boolean(\"isEmailVerified\").default(false).notNull(),\n  \n  // Generated fields\n  accountNumber: varchar(\"account_number\", { length: 20 }).unique(), \n  customerId: varchar(\"customer_id\", { length: 15 }).unique(), // Auto-generated customer ID\n  balance: numeric(\"balance\", { precision: 12, scale: 2 }).default(\"0.00\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n});\n\nexport const otps = pgTable(\"otps\", {\n  id: serial(\"id\").primaryKey(),\n  email: text(\"email\").notNull(),\n  code: text(\"code\").notNull(),\n  purpose: text(\"purpose\").default(\"EMAIL_VERIFICATION\").notNull(),\n  expiresAt: timestamp(\"expires_at\").notNull(),\n});\n\nexport const transactions = pgTable(\"transactions\", {\n  id: serial(\"id\").primaryKey(),\n  userId: integer(\"user_id\").references(() => users.id).notNull(),\n  type: text(\"type\", { enum: [\"CREDIT\", \"DEBIT\"] }).notNull(),\n  amount: numeric(\"amount\", { precision: 12, scale: 2 }).notNull(),\n  description: text(\"description\").notNull(),\n  createdAt: timestamp(\"created_at\").defaultNow(),\n  createdBy: text(\"created_by\", { enum: [\"SYSTEM\", \"ADMIN\"] }).default(\"SYSTEM\").notNull(),\n});\n\n// Schemas\nexport const insertUserSchema = createInsertSchema(users).omit({ \n  id: true, \n  createdAt: true, \n  accountNumber: true, \n  customerId: true,\n  balance: true,\n  role: true, \n  status: true,\n  isEmailVerified: true\n}).extend({\n  password: z.string().min(8),\n  transactionPin: z.string().min(4).max(6),\n});\n\nexport const insertTransactionSchema = createInsertSchema(transactions).omit({ \n  id: true, \n  createdAt: true \n});\n\n// Types\nexport type User = typeof users.$inferSelect;\nexport type InsertUser = z.infer<typeof insertUserSchema>;\nexport type Transaction = typeof transactions.$inferSelect;\nexport type InsertTransaction = z.infer<typeof insertTransactionSchema>;\n\n// Auth types\nexport const loginSchema = z.object({\n  email: z.string().email(),\n  password: z.string(),\n});\n\nexport const otpSchema = z.object({\n  email: z.string().email(),\n  code: z.string().length(6),\n});\n\nexport type LoginRequest = z.infer<typeof loginSchema>;\nexport type OtpRequest = z.infer<typeof otpSchema>;\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 191, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/shared/routes.ts"],"sourcesContent":["import { z } from 'zod';\nimport { insertUserSchema, users, transactions, insertTransactionSchema, loginSchema, otpSchema } from './schema';\n\nexport const errorSchemas = {\n  validation: z.object({\n    message: z.string(),\n    field: z.string().optional(),\n  }),\n  notFound: z.object({\n    message: z.string(),\n  }),\n  unauthorized: z.object({\n    message: z.string(),\n  }),\n  forbidden: z.object({\n    message: z.string(),\n  }),\n};\n\nexport const api = {\n  auth: {\n    register: {\n      method: 'POST' as const,\n      path: '/api/auth/register',\n      input: insertUserSchema,\n      responses: {\n        201: z.object({ message: z.string(), email: z.string() }),\n        400: errorSchemas.validation,\n      },\n    },\n    verifyOtp: {\n      method: 'POST' as const,\n      path: '/api/auth/verify-otp',\n      input: otpSchema,\n      responses: {\n        200: z.object({ message: z.string(), user: z.custom<typeof users.$inferSelect>() }),\n        400: errorSchemas.validation,\n      },\n    },\n    login: {\n      method: 'POST' as const,\n      path: '/api/auth/login',\n      input: loginSchema,\n      responses: {\n        200: z.custom<typeof users.$inferSelect>(),\n        401: errorSchemas.unauthorized,\n      },\n    },\n    logout: {\n      method: 'POST' as const,\n      path: '/api/auth/logout',\n      responses: {\n        200: z.void(),\n      },\n    },\n    me: {\n      method: 'GET' as const,\n      path: '/api/user',\n      responses: {\n        200: z.custom<typeof users.$inferSelect>(),\n        401: errorSchemas.unauthorized,\n      },\n    },\n    forgotPassword: {\n      method: 'POST' as const,\n      path: '/api/auth/forgot-password',\n      input: z.object({ email: z.string().email() }),\n      responses: {\n        200: z.object({ message: z.string() }),\n        400: errorSchemas.validation,\n      },\n    },\n    resetPassword: {\n      method: 'POST' as const,\n      path: '/api/auth/reset-password',\n      input: z.object({\n        email: z.string().email(),\n        code: z.string().length(6),\n        newPassword: z.string().min(8),\n      }),\n      responses: {\n        200: z.object({ message: z.string() }),\n        400: errorSchemas.validation,\n      },\n    },\n  },\n  admin: {\n    listUsers: {\n      method: 'GET' as const,\n      path: '/api/admin/users',\n      responses: {\n        200: z.array(z.custom<typeof users.$inferSelect>()),\n        403: errorSchemas.forbidden,\n      },\n    },\n    approveUser: {\n      method: 'POST' as const,\n      path: '/api/admin/users/:id/approve',\n      responses: {\n        200: z.custom<typeof users.$inferSelect>(),\n        404: errorSchemas.notFound,\n      },\n    },\n    rejectUser: {\n      method: 'POST' as const,\n      path: '/api/admin/users/:id/reject',\n      responses: {\n        200: z.custom<typeof users.$inferSelect>(),\n        404: errorSchemas.notFound,\n      },\n    },\n    createTransaction: {\n      method: 'POST' as const,\n      path: '/api/admin/transactions',\n      input: insertTransactionSchema\n        .omit({ createdBy: true })\n        .extend({\n          userId: z.coerce.number().int().min(1, \"User is required\"),\n          amount: z.coerce.string(), // Accept number and convert to string\n        }),\n      responses: {\n        201: z.custom<typeof transactions.$inferSelect>(),\n        400: errorSchemas.validation,\n      },\n    },\n    listAllTransactions: {\n      method: 'GET' as const,\n      path: '/api/admin/transactions',\n      responses: {\n        200: z.array(z.custom<typeof transactions.$inferSelect>()),\n      },\n    }\n  },\n  user: {\n    listTransactions: {\n      method: 'GET' as const,\n      path: '/api/transactions',\n      responses: {\n        200: z.array(z.custom<typeof transactions.$inferSelect>()),\n      },\n    },\n  },\n};\n\nexport function buildUrl(path: string, params?: Record<string, string | number>): string {\n  let url = path;\n  if (params) {\n    Object.entries(params).forEach(([key, value]) => {\n      if (url.includes(`:${key}`)) {\n        url = url.replace(`:${key}`, String(value));\n      }\n    });\n  }\n  return url;\n}\n"],"names":[],"mappings":"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"}},
    {"offset": {"line": 369, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase client with public environment variables\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Export a server-side client that uses service role key for admin operations\nexport async function createAdminSupabaseClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\n  const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n  \n  // Create a client with service role for admin operations\n  return createClient(supabaseUrl, supabaseServiceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  });\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,+DAA+D;AAC/D,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,0NAAY,EAAC,aAAa;AAG3C,eAAe;IACpB,MAAM;IACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;IAEpE,yDAAyD;IACzD,OAAO,IAAA,0NAAY,EAAC,aAAa,wBAAwB;QACvD,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 396, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/server/admin-storage.ts"],"sourcesContent":["import { createAdminSupabaseClient, supabase } from '@lib/supabase';\nimport { User, Transaction } from '@shared/schema';\n\nexport interface IStorage {\n  // Users\n  getUser(id: number): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  createUser(user: any): Promise<User>;\n  updateUserStatus(id: number, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined>;\n  updateUserBalance(id: number, balance: string): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  updateUserAccountNumber(id: number, accountNumber: string): Promise<User | undefined>;\n  verifyUserEmail(email: string): Promise<void>;\n  updateUserPassword(id: number, password: string): Promise<void>;\n\n  // OTPs\n  createOtp(email: string, code: string, purpose?: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<void>;\n  verifyOtp(email: string, code: string, purpose?: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<boolean>;\n\n  // Transactions\n  createTransaction(transaction: any): Promise<Transaction>;\n  getTransactionsByUserId(userId: number): Promise<Transaction[]>;\n  getAllTransactions(): Promise<Transaction[]>;\n}\n\nexport class SupabaseAdminStorage implements IStorage {\n  // Methods that require admin privileges\n  async getUser(id: number): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select('*')\n      .eq('email', email)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data ?? undefined;\n  }\n\n  async createUser(user: any): Promise<User> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .insert([user])\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async updateUserStatus(id: number, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ status })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async updateUserBalance(id: number, balance: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ balance })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async updateUserAccountNumber(id: number, accountNumber: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ account_number: accountNumber })\n      .eq('id', id)\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async verifyUserEmail(email: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    const { error } = await adminClient\n      .from('users')\n      .update({ isEmailVerified: true })\n      .eq('email', email);\n\n    if (error) throw error;\n  }\n\n  async updateUserPassword(id: number, password: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    const { error } = await adminClient\n      .from('users')\n      .update({ password })\n      .eq('id', id);\n\n    if (error) throw error;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select('*')\n      .order('createdAt', { ascending: false });\n\n    if (error) throw error;\n    return data;\n  }\n\n  // OTPs\n  async createOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\" = \"EMAIL_VERIFICATION\"): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    // First delete any existing OTPs for this email and purpose\n    await adminClient\n      .from('otps')\n      .delete()\n      .match({ email, purpose });\n\n    const expiresAt = new Date(Date.now() + 5 * 60 * 1000); // 5 minutes from now\n    const { error } = await adminClient\n      .from('otps')\n      .insert([{ email, code, purpose, expires_at: expiresAt.toISOString() }]);\n\n    if (error) throw error;\n  }\n\n  async verifyOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\" = \"EMAIL_VERIFICATION\"): Promise<boolean> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('otps')\n      .select('*')\n      .match({ email, code, purpose })\n      .maybeSingle();\n\n    if (error || !data) return false;\n\n    // Check expiration\n    if (new Date() > new Date(data.expires_at ?? data.expiresAt)) {\n      // Delete expired OTP\n      await adminClient\n        .from('otps')\n        .delete()\n        .eq('id', data.id);\n      return false;\n    }\n\n    // Delete OTP after successful verification\n    await adminClient\n      .from('otps')\n      .delete()\n      .eq('id', data.id);\n      \n    return true;\n  }\n\n  // Transactions\n  async createTransaction(transaction: any): Promise<Transaction> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transactions')\n      .insert([transaction])\n      .select()\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transactions')\n      .select('*')\n      .eq('userId', userId)\n      .order('createdAt', { ascending: false });\n\n    if (error) throw error;\n    return data;\n  }\n\n  async getAllTransactions(): Promise<Transaction[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transactions')\n      .select('*')\n      .order('createdAt', { ascending: false });\n\n    if (error) throw error;\n    return data;\n  }\n}\n\n// For non-admin operations, use the regular client\nexport class SupabasePublicStorage implements IStorage {\n  // Public methods that don't require admin privileges\n  async getUser(id: number): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('id', id)\n      .single();\n\n    if (error) throw error;\n    return data;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select('*')\n      .eq('email', email)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data ?? undefined;\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    const { data, error } = await supabase\n      .from('transactions')\n      .select('*')\n      .eq('userId', userId)\n      .order('createdAt', { ascending: false });\n\n    if (error) throw error;\n    return data;\n  }\n\n  // Other public methods should throw an error since they require admin access\n  async createUser(user: any): Promise<User> {\n    throw new Error(\"Create user must be done through public registration endpoint\");\n  }\n\n  async updateUserStatus(id: number, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined> {\n    throw new Error(\"Update user status requires admin privileges\");\n  }\n\n  async updateUserBalance(id: number, balance: string): Promise<User | undefined> {\n    throw new Error(\"Update user balance requires admin privileges\");\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    throw new Error(\"Get all users requires admin privileges\");\n  }\n\n  async updateUserAccountNumber(id: number, accountNumber: string): Promise<User | undefined> {\n    throw new Error(\"Update account number requires admin privileges\");\n  }\n\n  async verifyUserEmail(email: string): Promise<void> {\n    throw new Error(\"Verify email requires admin privileges\");\n  }\n\n  async updateUserPassword(id: number, password: string): Promise<void> {\n    throw new Error(\"Update password requires admin privileges\");\n  }\n\n  async createOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<void> {\n    throw new Error(\"Create OTP requires admin privileges\");\n  }\n\n  async verifyOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<boolean> {\n    throw new Error(\"Verify OTP requires admin privileges\");\n  }\n\n  async createTransaction(transaction: any): Promise<Transaction> {\n    throw new Error(\"Create transaction requires admin privileges\");\n  }\n\n  async getAllTransactions(): Promise<Transaction[]> {\n    throw new Error(\"Get all transactions requires admin privileges\");\n  }\n}\n\n// Export admin storage for server-side operations\nexport const adminStorage = new SupabaseAdminStorage();\nexport const publicStorage = new SupabasePublicStorage();"],"names":[],"mappings":"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"}},
    {"offset": {"line": 599, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/server/storage.ts"],"sourcesContent":["// This is a facade that exposes the right storage methods for different contexts\n// For API routes that need admin operations, import adminStorage directly\n// For public operations, use publicStorage directly\nexport { adminStorage, publicStorage } from './admin-storage';"],"names":[],"mappings":";AAAA,iFAAiF;AACjF,0EAA0E;AAC1E,oDAAoD;AACpD"}},
    {"offset": {"line": 621, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/app/api/utils/auth.ts"],"sourcesContent":["import { scrypt, randomBytes, timingSafeEqual } from 'crypto';\nimport { promisify } from 'util';\n\nconst scryptAsync = promisify(scrypt);\n\nexport async function hashPassword(password: string) {\n  const salt = randomBytes(16).toString('hex');\n  const buf = (await scryptAsync(password, salt, 64)) as Buffer;\n  return `${buf.toString('hex')}.${salt}`;\n}\n\nexport async function comparePasswords(supplied: string, stored: string) {\n  const [hashed, salt] = stored.split('.');\n  const hashedBuf = Buffer.from(hashed, 'hex');\n  const suppliedBuf = (await scryptAsync(supplied, salt, 64)) as Buffer;\n  return timingSafeEqual(hashedBuf, suppliedBuf);\n}"],"names":[],"mappings":";;;;;;AAAA;AACA;;;AAEA,MAAM,cAAc,IAAA,8GAAS,EAAC,+GAAM;AAE7B,eAAe,aAAa,QAAgB;IACjD,MAAM,OAAO,IAAA,oHAAW,EAAC,IAAI,QAAQ,CAAC;IACtC,MAAM,MAAO,MAAM,YAAY,UAAU,MAAM;IAC/C,OAAO,GAAG,IAAI,QAAQ,CAAC,OAAO,CAAC,EAAE,MAAM;AACzC;AAEO,eAAe,iBAAiB,QAAgB,EAAE,MAAc;IACrE,MAAM,CAAC,QAAQ,KAAK,GAAG,OAAO,KAAK,CAAC;IACpC,MAAM,YAAY,OAAO,IAAI,CAAC,QAAQ;IACtC,MAAM,cAAe,MAAM,YAAY,UAAU,MAAM;IACvD,OAAO,IAAA,wHAAe,EAAC,WAAW;AACpC"}},
    {"offset": {"line": 647, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/app/api/utils/user.ts"],"sourcesContent":["// Simple account number generator\nexport function generateAccountNumber() {\n  return '202' + Math.floor(100000000 + Math.random() * 900000000).toString();\n}\n\n// Customer ID generator\nexport function generateCustomerId() {\n  return 'CU' + Math.floor(1000000000000 + Math.random() * 9000000000000).toString();\n}"],"names":[],"mappings":"AAAA,kCAAkC;;;;;;;AAC3B,SAAS;IACd,OAAO,QAAQ,KAAK,KAAK,CAAC,YAAY,KAAK,MAAM,KAAK,WAAW,QAAQ;AAC3E;AAGO,SAAS;IACd,OAAO,OAAO,KAAK,KAAK,CAAC,gBAAgB,KAAK,MAAM,KAAK,eAAe,QAAQ;AAClF"}},
    {"offset": {"line": 742, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/server/mailer.ts"],"sourcesContent":["import nodemailer, { type Transporter } from \"nodemailer\";\n\ntype MailConfig = {\n  host?: string;\n  port: number;\n  user?: string;\n  pass?: string;\n  from?: string;\n  service?: string;\n};\n\ntype OtpPurpose = \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\";\n\nfunction getMailConfig(): MailConfig {\n  return {\n    host: process.env.SMTP_HOST,\n    port: Number(process.env.SMTP_PORT || 587),\n    user: process.env.SMTP_USER,\n    pass: process.env.SMTP_PASS,\n    from: process.env.EMAIL_FROM,\n    service: process.env.SMTP_SERVICE,\n  };\n}\n\nlet transporter: Transporter | null = null;\n\nfunction getTransporter(config: MailConfig): Transporter {\n  if (!(config.service || config.host) || !config.user || !config.pass) {\n    throw new Error(\n      \"SMTP configuration is incomplete. Please set SMTP credentials (e.g. SMTP_HOST/PORT or SMTP_SERVICE) along with SMTP_USER and SMTP_PASS.\"\n    );\n  }\n\n  if (!transporter) {\n    const baseOptions: any = {\n      auth: {\n        user: config.user,\n        pass: config.pass,\n      },\n    };\n\n    if (config.service) {\n      baseOptions.service = config.service;\n    } else {\n      baseOptions.host = config.host;\n      baseOptions.port = config.port;\n      baseOptions.secure = config.port === 465;\n    }\n\n    transporter = nodemailer.createTransport(baseOptions);\n  }\n\n  return transporter;\n}\n\nfunction getCopy(purpose: OtpPurpose) {\n  if (purpose === \"PASSWORD_RESET\") {\n    return {\n      subject: \"Reset your UnitedHorizon password\",\n      title: \"Password reset request\",\n      body: \"Use the verification code below to reset your password. This code expires in 5 minutes.\",\n    };\n  }\n  return {\n    subject: \"Verify your UnitedHorizon account\",\n    title: \"Verify your email\",\n    body: \"Use the verification code below to complete your registration. This code expires in 5 minutes.\",\n  };\n}\n\nexport async function sendOtpEmail(to: string, code: string, purpose: OtpPurpose = \"EMAIL_VERIFICATION\") {\n  const config = getMailConfig();\n  const mailer = getTransporter(config);\n  const fromAddress = config.from || config.user;\n  const copy = getCopy(purpose);\n\n  await mailer.sendMail({\n    from: fromAddress,\n    to,\n    subject: copy.subject,\n    text: `${copy.body} Code: ${code}`,\n    html: `\n      <div style=\"font-family: 'Helvetica Neue', Arial, sans-serif; line-height: 1.6; color: #0f172a;\">\n        <h2 style=\"color: #0f172a;\">${copy.title}</h2>\n        <p>${copy.body}</p>\n        <p style=\"font-size: 32px; font-weight: 700; letter-spacing: 8px; color: #ea580c;\">${code}</p>\n        <p>If you did not request this code, you can safely ignore this email.</p>\n      </div>\n    `,\n  });\n}\n"],"names":[],"mappings":";;;;AAAA;;AAaA,SAAS;IACP,OAAO;QACL,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,OAAO,QAAQ,GAAG,CAAC,SAAS,IAAI;QACtC,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,QAAQ,GAAG,CAAC,SAAS;QAC3B,MAAM,QAAQ,GAAG,CAAC,UAAU;QAC5B,SAAS,QAAQ,GAAG,CAAC,YAAY;IACnC;AACF;AAEA,IAAI,cAAkC;AAEtC,SAAS,eAAe,MAAkB;IACxC,IAAI,CAAC,CAAC,OAAO,OAAO,IAAI,OAAO,IAAI,KAAK,CAAC,OAAO,IAAI,IAAI,CAAC,OAAO,IAAI,EAAE;QACpE,MAAM,IAAI,MACR;IAEJ;IAEA,IAAI,CAAC,aAAa;QAChB,MAAM,cAAmB;YACvB,MAAM;gBACJ,MAAM,OAAO,IAAI;gBACjB,MAAM,OAAO,IAAI;YACnB;QACF;QAEA,IAAI,OAAO,OAAO,EAAE;YAClB,YAAY,OAAO,GAAG,OAAO,OAAO;QACtC,OAAO;YACL,YAAY,IAAI,GAAG,OAAO,IAAI;YAC9B,YAAY,IAAI,GAAG,OAAO,IAAI;YAC9B,YAAY,MAAM,GAAG,OAAO,IAAI,KAAK;QACvC;QAEA,cAAc,sLAAU,CAAC,eAAe,CAAC;IAC3C;IAEA,OAAO;AACT;AAEA,SAAS,QAAQ,OAAmB;IAClC,IAAI,YAAY,kBAAkB;QAChC,OAAO;YACL,SAAS;YACT,OAAO;YACP,MAAM;QACR;IACF;IACA,OAAO;QACL,SAAS;QACT,OAAO;QACP,MAAM;IACR;AACF;AAEO,eAAe,aAAa,EAAU,EAAE,IAAY,EAAE,UAAsB,oBAAoB;IACrG,MAAM,SAAS;IACf,MAAM,SAAS,eAAe;IAC9B,MAAM,cAAc,OAAO,IAAI,IAAI,OAAO,IAAI;IAC9C,MAAM,OAAO,QAAQ;IAErB,MAAM,OAAO,QAAQ,CAAC;QACpB,MAAM;QACN;QACA,SAAS,KAAK,OAAO;QACrB,MAAM,GAAG,KAAK,IAAI,CAAC,OAAO,EAAE,MAAM;QAClC,MAAM,CAAC;;oCAEyB,EAAE,KAAK,KAAK,CAAC;WACtC,EAAE,KAAK,IAAI,CAAC;2FACoE,EAAE,KAAK;;;IAG9F,CAAC;IACH;AACF"}},
    {"offset": {"line": 819, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/app/api/auth/register/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { api } from '@shared/routes';\nimport { adminStorage } from '@server/storage';\nimport { hashPassword } from '../../utils/auth';\nimport { generateAccountNumber, generateCustomerId } from '../../utils/user';\nimport { sendOtpEmail } from '@server/mailer';\n\nexport async function POST(request: NextRequest) {\n  try {\n    const input = api.auth.register.input.parse(await request.json());\n    console.log(\"Registration input received:\", JSON.stringify(input, null, 2));\n\n    const existing = await adminStorage.getUserByEmail(input.email);\n    if (existing) {\n      return Response.json({ message: \"Email already registered\" }, { status: 400 });\n    }\n\n    const hashedPassword = await hashPassword(input.password);\n    const accountNumber = generateAccountNumber();\n    const customerId = generateCustomerId();\n\n    const userToCreate = {\n      ...input,\n      password: hashedPassword,\n      accountNumber,\n      customerId,\n      role: \"USER\",\n      status: \"PENDING\",\n      balance: \"0.00\",\n      isEmailVerified: false,\n    };\n\n    const dbPayload = {\n      first_name: userToCreate.firstName,\n      last_name: userToCreate.lastName,\n      other_name: userToCreate.otherName ?? null,\n      email: userToCreate.email,\n      phone: userToCreate.phone,\n      dob: userToCreate.dob,\n      gender: userToCreate.gender,\n      nationality: userToCreate.nationality,\n      address: userToCreate.address,\n      city: userToCreate.city,\n      state: userToCreate.state,\n      country: userToCreate.country,\n      zip_code: userToCreate.zipCode,\n      id_type: userToCreate.idType,\n      id_number: userToCreate.idNumber,\n      id_expiry_date: userToCreate.idExpiryDate,\n      id_image_url: userToCreate.idImageUrl ?? null,\n      selfie_url: userToCreate.selfieUrl ?? null,\n      account_type: userToCreate.accountType,\n      currency: userToCreate.currency,\n      account_purpose: userToCreate.accountPurpose ?? null,\n      password: userToCreate.password,\n      transaction_pin: userToCreate.transactionPin,\n      role: userToCreate.role,\n      status: userToCreate.status,\n      isEmailVerified: userToCreate.isEmailVerified,\n      account_number: userToCreate.accountNumber,\n      customer_id: userToCreate.customerId,\n      balance: userToCreate.balance,\n    };\n\n    console.log(\"Creating user with data:\", JSON.stringify(userToCreate, null, 2));\n\n    const user = await adminStorage.createUser(dbPayload);\n\n    // Generate OTP\n    const code = Math.floor(100000 + Math.random() * 900000).toString();\n    await adminStorage.createOtp(user.email, code);\n\n    try {\n      await sendOtpEmail(user.email, code, \"EMAIL_VERIFICATION\");\n      console.log(`[OTP EMAIL SENT] To: ${user.email}`);\n    } catch (emailErr) {\n      console.error(\"Failed to send OTP email\", emailErr);\n      return Response.json({\n        message:\n          \"User created but we could not send the verification email. Please try again later.\",\n      }, { status: 500 });\n    }\n\n    return Response.json({\n      message: \"User created. Please verify your email with the OTP code sent to your email.\",\n      email: user.email\n    }, { status: 201 });\n  } catch (err: any) {\n    console.error(\"Registration error:\", err);\n    if (err.name === 'ZodError') {\n      return Response.json({ message: err.errors[0].message }, { status: 400 });\n    } else {\n      return Response.json({ message: err.message || \"Internal server error\" }, { status: 500 });\n    }\n  }\n}"],"names":[],"mappings":"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"}}]
}