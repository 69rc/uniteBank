{
  "version": 3,
  "sources": [],
  "sections": [
    {"offset": {"line": 40, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/lib/supabase.ts"],"sourcesContent":["import { createClient } from '@supabase/supabase-js';\n\n// Initialize Supabase client with public environment variables\nconst supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\nconst supabaseAnonKey = process.env.NEXT_PUBLIC_SUPABASE_ANON_KEY!;\n\nexport const supabase = createClient(supabaseUrl, supabaseAnonKey);\n\n// Export a server-side client that uses service role key for admin operations\nexport async function createAdminSupabaseClient() {\n  const supabaseUrl = process.env.NEXT_PUBLIC_SUPABASE_URL!;\n  const supabaseServiceRoleKey = process.env.SUPABASE_SERVICE_ROLE_KEY!;\n  \n  // Create a client with service role for admin operations\n  return createClient(supabaseUrl, supabaseServiceRoleKey, {\n    auth: {\n      autoRefreshToken: false,\n      persistSession: false,\n    },\n  });\n}"],"names":[],"mappings":";;;;;;AAAA;;AAEA,+DAA+D;AAC/D,MAAM;AACN,MAAM;AAEC,MAAM,WAAW,IAAA,0NAAY,EAAC,aAAa;AAG3C,eAAe;IACpB,MAAM;IACN,MAAM,yBAAyB,QAAQ,GAAG,CAAC,yBAAyB;IAEpE,yDAAyD;IACzD,OAAO,IAAA,0NAAY,EAAC,aAAa,wBAAwB;QACvD,MAAM;YACJ,kBAAkB;YAClB,gBAAgB;QAClB;IACF;AACF"}},
    {"offset": {"line": 67, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/server/admin-storage.ts"],"sourcesContent":["import { createAdminSupabaseClient, supabase } from '@lib/supabase';\nimport { User, Transaction } from '@shared/schema';\n\nexport interface IStorage {\n  // Users\n  getUser(id: number): Promise<User | undefined>;\n  getUserByUuid(uuid: string): Promise<User | undefined>;\n  getUserByEmail(email: string): Promise<User | undefined>;\n  getUserByAccountNumber(accountNumber: string): Promise<User | undefined>;\n  getUserByCustomerId(customerId: string): Promise<User | undefined>;\n  createUser(user: any): Promise<User>;\n  updateUserStatus(id: number, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined>;\n  updateUserStatusByUuid(uuid: string, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined>;\n  updateUserBalance(id: number, balance: string): Promise<User | undefined>;\n  updateUserBalanceByUuid(uuid: string, balance: string): Promise<User | undefined>;\n  getAllUsers(): Promise<User[]>;\n  updateUserAccountNumber(id: number, accountNumber: string): Promise<User | undefined>;\n  verifyUserEmail(email: string): Promise<void>;\n  updateUserPassword(id: number, password: string): Promise<void>;\n  updateUserPasswordByUuid(uuid: string, password: string): Promise<void>;\n\n  // OTPs\n  createOtp(email: string, code: string, purpose?: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<void>;\n  verifyOtp(email: string, code: string, purpose?: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<boolean>;\n\n  // Transactions\n  createTransaction(transaction: any): Promise<Transaction>;\n  getTransactionsByUserId(userId: number): Promise<Transaction[]>;\n  getTransactionsByUserUuid(uuid: string): Promise<Transaction[]>;\n  getAllTransactions(): Promise<Transaction[]>;\n\n  // Transfers\n  getAllPendingTransfers(): Promise<any[]>;\n  approveTransfer(transferId: number, adminId: string): Promise<void>;\n  rejectTransfer(transferId: number, adminId: string): Promise<void>;\n}\n\n// Helper functions to convert between snake_case and camelCase\nfunction snakeToCamel<T extends Record<string, any>>(obj: T): any {\n  const result = {} as any;\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      const camelKey = key.replace(/_([a-z])/g, (g) => g[1].toUpperCase());\n      result[camelKey] = obj[key];\n    }\n  }\n  return result;\n}\n\nfunction camelToSnake<T extends Record<string, any>>(obj: T): any {\n  const result = {} as any;\n  for (const key in obj) {\n    if (obj.hasOwnProperty(key)) {\n      const snakeKey = key.replace(/[A-Z]/g, (letter) => `_${letter.toLowerCase()}`);\n      result[snakeKey] = obj[key];\n    }\n  }\n  return result;\n}\n\nexport class SupabaseAdminStorage implements IStorage {\n  // Methods that require admin privileges\n  async getUser(id: number): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('id', id)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('email', email)\n      .maybeSingle();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async createUser(user: any): Promise<User> {\n    const adminClient = await createAdminSupabaseClient();\n    // Convert camelCase to snake_case for insertion\n    const snakeUser = camelToSnake(user);\n    const { data, error } = await adminClient\n      .from('users')\n      .insert([snakeUser])\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    throw new Error('User creation failed');\n  }\n\n  async updateUserStatus(id: number, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ status })\n      .eq('id', id)\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async updateUserStatusByUuid(uuid: string, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ status })\n      .eq('id', uuid)\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async updateUserBalance(id: number, balance: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ balance })\n      .eq('id', id)\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async updateUserBalanceByUuid(uuid: string, balance: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ balance })\n      .eq('id', uuid)\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async updateUserAccountNumber(id: number, accountNumber: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .update({ account_number: accountNumber })\n      .eq('id', id)\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async verifyUserEmail(email: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    const { error } = await adminClient\n      .from('users')\n      .update({ \"isEmailVerified\": true })\n      .eq('email', email);\n\n    if (error) throw error;\n  }\n\n  async updateUserPassword(id: number, password: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    const { error } = await adminClient\n      .from('users')\n      .update({ password })\n      .eq('id', id);\n\n    if (error) throw error;\n  }\n\n  async updateUserPasswordByUuid(uuid: string, password: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    const { error } = await adminClient\n      .from('users')\n      .update({ password })\n      .eq('id', uuid);\n\n    if (error) throw error;\n  }\n\n  async getUserByAccountNumber(accountNumber: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('account_number', accountNumber)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async getUserByCustomerId(customerId: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('customer_id', customerId)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async getUserByUuid(uuid: string): Promise<User | undefined> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('id', uuid)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as User;\n    }\n    return undefined;\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('users')\n      .select('*')\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data?.map(snakeToCamel) as User[] || [];\n  }\n\n  // OTPs\n  async createOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\" = \"EMAIL_VERIFICATION\"): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n    // First delete any existing OTPs for this email\n    await adminClient\n      .from('otps')\n      .delete()\n      .match({ email });\n\n    const expiresAt = new Date(Date.now() + 5 * 60 * 1000); // 5 minutes from now\n    const { error } = await adminClient\n      .from('otps')\n      .insert([{ email, code, expires_at: expiresAt.toISOString() }]);\n\n    if (error) throw error;\n  }\n\n  async verifyOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\" = \"EMAIL_VERIFICATION\"): Promise<boolean> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('otps')\n      .select('*')\n      .match({ email, code })\n      .maybeSingle();\n\n    if (error || !data) return false;\n\n    // Check expiration\n    if (new Date() > new Date(data.expires_at ?? data.expiresAt)) {\n      // Delete expired OTP\n      await adminClient\n        .from('otps')\n        .delete()\n        .eq('id', data.id);\n      return false;\n    }\n\n    // Delete OTP after successful verification\n    await adminClient\n      .from('otps')\n      .delete()\n      .eq('id', data.id);\n\n    return true;\n  }\n\n  // Transactions\n  async createTransaction(transaction: any): Promise<Transaction> {\n    const adminClient = await createAdminSupabaseClient();\n    // Convert camelCase to snake_case for insertion\n    const snakeTransaction = camelToSnake(transaction);\n    const { data, error } = await adminClient\n      .from('transactions')\n      .insert([snakeTransaction])\n      .select(`\n        id,\n        user_id,\n        type,\n        amount,\n        description,\n        created_by,\n        created_at\n      `)\n      .single();\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    if (data) {\n      return snakeToCamel(data) as Transaction;\n    }\n    throw new Error('Transaction creation failed');\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transactions')\n      .select(`\n        id,\n        user_id,\n        type,\n        amount,\n        description,\n        created_by,\n        created_at\n      `)\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    return data?.map(snakeToCamel) as Transaction[] || [];\n  }\n\n  async getTransactionsByUserUuid(uuid: string): Promise<Transaction[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transactions')\n      .select(`\n        id,\n        user_id,\n        type,\n        amount,\n        description,\n        created_by,\n        created_at\n      `)\n      .eq('user_id', uuid)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    return data?.map(snakeToCamel) as Transaction[] || [];\n  }\n\n  async getAllTransactions(): Promise<Transaction[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transactions')\n      .select(`\n        id,\n        user_id,\n        type,\n        amount,\n        description,\n        created_by,\n        created_at\n      `)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    return data?.map(snakeToCamel) as Transaction[] || [];\n  }\n  // Transfers\n  async getAllPendingTransfers(): Promise<any[]> {\n    const adminClient = await createAdminSupabaseClient();\n    const { data, error } = await adminClient\n      .from('transfers')\n      .select(`\n        id,\n        sender_id,\n        recipient_id,\n        amount,\n        description,\n        status,\n        admin_note,\n        approved_by,\n        created_at,\n        processed_at\n      `)\n      .eq('status', 'PENDING')\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    // Transform snake_case response to camelCase to match schema\n    return data?.map(snakeToCamel) || [];\n  }\n\n  async approveTransfer(transferId: number, adminId: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n\n    // 1. Fetch transfer details\n    const { data: transfer, error: fetchError } = await adminClient\n      .from('transfers')\n      .select('*')\n      .eq('id', transferId)\n      .single();\n\n    if (fetchError || !transfer) throw new Error('Transfer not found');\n    if (transfer.status !== 'PENDING') throw new Error('Transfer is not pending');\n\n    const amount = parseFloat(transfer.amount);\n    const senderId = transfer.sender_id;\n    const recipientId = transfer.recipient_id;\n\n    // 2. Fetch Sender and Recipient\n    const { data: sender, error: senderError } = await adminClient\n      .from('users')\n      .select('balance')\n      .eq('id', senderId)\n      .single();\n\n    if (senderError || !sender) throw new Error('Sender not found');\n\n    const { data: recipient, error: recipientError } = await adminClient\n      .from('users')\n      .select('balance')\n      .eq('id', recipientId)\n      .single();\n\n    if (recipientError || !recipient) throw new Error('Recipient not found');\n\n    const senderBalance = parseFloat(sender.balance);\n    if (senderBalance < amount) throw new Error('Insufficient funds');\n\n    // 3. Perform Updates (Sequentially for now, ideally RPC)\n    // Debit Sender\n    const newSenderBalance = (senderBalance - amount).toFixed(2);\n    const { error: debitError } = await adminClient\n      .from('users')\n      .update({ balance: newSenderBalance })\n      .eq('id', senderId);\n\n    if (debitError) throw new Error('Failed to debit sender');\n\n    // Credit Recipient\n    const recipientBalance = parseFloat(recipient.balance);\n    const newRecipientBalance = (recipientBalance + amount).toFixed(2);\n    const { error: creditError } = await adminClient\n      .from('users')\n      .update({ balance: newRecipientBalance })\n      .eq('id', recipientId);\n\n    if (creditError) {\n      // Rollback sender debit (manual compensation)\n      await adminClient.from('users').update({ balance: sender.balance }).eq('id', senderId);\n      throw new Error('Failed to credit recipient');\n    }\n\n    // Create Debit Transaction\n    await adminClient.from('transactions').insert([{\n      user_id: senderId,\n      type: 'DEBIT',\n      amount: amount.toFixed(2),\n      description: `Transfer to ${recipientId}: ${transfer.description}`, // Ideally use names\n      created_by: 'ADMIN'\n    }]);\n\n    // Create Credit Transaction\n    await adminClient.from('transactions').insert([{\n      user_id: recipientId,\n      type: 'CREDIT',\n      amount: amount.toFixed(2),\n      description: `Transfer from ${senderId}: ${transfer.description}`,\n      created_by: 'ADMIN'\n    }]);\n\n    // Update Transfer Status\n    await adminClient\n      .from('transfers')\n      .update({\n        status: 'APPROVED',\n        approved_by: adminId,\n        processed_at: new Date().toISOString()\n      })\n      .eq('id', transferId);\n  }\n\n  async rejectTransfer(transferId: number, adminId: string): Promise<void> {\n    const adminClient = await createAdminSupabaseClient();\n\n    await adminClient\n      .from('transfers')\n      .update({\n        status: 'REJECTED',\n        approved_by: adminId,\n        processed_at: new Date().toISOString()\n      })\n      .eq('id', transferId);\n  }\n}\n\n// For non-admin operations, use the regular client\nexport class SupabasePublicStorage implements IStorage {\n  // Public methods that don't require admin privileges\n  async getUser(id: number): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('id', id)\n      .single();\n\n    if (error) throw error;\n    return data ? snakeToCamel(data) : undefined;\n  }\n\n  async getUserByEmail(email: string): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('email', email)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data ? snakeToCamel(data) : undefined;\n  }\n\n  async getUserByAccountNumber(accountNumber: string): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('account_number', accountNumber)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data ? snakeToCamel(data) : undefined;\n  }\n\n  async getUserByCustomerId(customerId: string): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('customer_id', customerId)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data ? snakeToCamel(data) : undefined;\n  }\n\n  async getUserByUuid(uuid: string): Promise<User | undefined> {\n    const { data, error } = await supabase\n      .from('users')\n      .select(`\n        id,\n        first_name,\n        last_name,\n        other_name,\n        email,\n        phone,\n        dob,\n        gender,\n        nationality,\n        address,\n        city,\n        state,\n        country,\n        zip_code,\n        id_type,\n        id_number,\n        id_expiry_date,\n        id_image_url,\n        selfie_url,\n        account_type,\n        currency,\n        account_purpose,\n        password,\n        transaction_pin,\n        role,\n        status,\n        \"isEmailVerified\",\n        account_number,\n        customer_id,\n        balance,\n        created_at\n      `)\n      .eq('id', uuid)\n      .maybeSingle();\n\n    if (error) throw error;\n    return data ? snakeToCamel(data) : undefined;\n  }\n\n  async getTransactionsByUserId(userId: number): Promise<Transaction[]> {\n    const { data, error } = await supabase\n      .from('transactions')\n      .select('*')\n      .eq('user_id', userId)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data?.map(snakeToCamel) as Transaction[] || [];\n  }\n\n  async getTransactionsByUserUuid(uuid: string): Promise<Transaction[]> {\n    const { data, error } = await supabase\n      .from('transactions')\n      .select('*')\n      .eq('user_id', uuid)\n      .order('created_at', { ascending: false });\n\n    if (error) throw error;\n    return data?.map(snakeToCamel) as Transaction[] || [];\n  }\n\n  // Other public methods should throw an error since they require admin access\n  async createUser(user: any): Promise<User> {\n    throw new Error(\"Create user must be done through public registration endpoint\");\n  }\n\n  async updateUserStatus(id: number, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined> {\n    throw new Error(\"Update user status requires admin privileges\");\n  }\n\n  async updateUserStatusByUuid(uuid: string, status: \"PENDING\" | \"APPROVED\" | \"REJECTED\"): Promise<User | undefined> {\n    throw new Error(\"Update user status requires admin privileges\");\n  }\n\n  async updateUserBalance(id: number, balance: string): Promise<User | undefined> {\n    throw new Error(\"Update user balance requires admin privileges\");\n  }\n\n  async updateUserBalanceByUuid(uuid: string, balance: string): Promise<User | undefined> {\n    throw new Error(\"Update user balance requires admin privileges\");\n  }\n\n  async getAllUsers(): Promise<User[]> {\n    throw new Error(\"Get all users requires admin privileges\");\n  }\n\n  async updateUserAccountNumber(id: number, accountNumber: string): Promise<User | undefined> {\n    throw new Error(\"Update account number requires admin privileges\");\n  }\n\n  async verifyUserEmail(email: string): Promise<void> {\n    throw new Error(\"Verify email requires admin privileges\");\n  }\n\n  async updateUserPassword(id: number, password: string): Promise<void> {\n    throw new Error(\"Update password requires admin privileges\");\n  }\n\n  async updateUserPasswordByUuid(uuid: string, password: string): Promise<void> {\n    throw new Error(\"Update password requires admin privileges\");\n  }\n\n  async createOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<void> {\n    throw new Error(\"Create OTP requires admin privileges\");\n  }\n\n  async verifyOtp(email: string, code: string, purpose: \"EMAIL_VERIFICATION\" | \"PASSWORD_RESET\"): Promise<boolean> {\n    throw new Error(\"Verify OTP requires admin privileges\");\n  }\n\n  async createTransaction(transaction: any): Promise<Transaction> {\n    throw new Error(\"Create transaction requires admin privileges\");\n  }\n\n  async getAllTransactions(): Promise<Transaction[]> {\n    throw new Error(\"Get all transactions requires admin privileges\");\n  }\n\n  // Transfers - Not implemented for public storage\n  async getAllPendingTransfers(): Promise<any[]> {\n    throw new Error(\"Unauthorized\");\n  }\n\n  async approveTransfer(transferId: number, adminId: string): Promise<void> {\n    throw new Error(\"Unauthorized\");\n  }\n\n  async rejectTransfer(transferId: number, adminId: string): Promise<void> {\n    throw new Error(\"Unauthorized\");\n  }\n}\n\n// Export admin storage for server-side operations\nexport const adminStorage = new SupabaseAdminStorage();\nexport const publicStorage = new SupabasePublicStorage();"],"names":[],"mappings":"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"}},
    {"offset": {"line": 1069, "column": 0}, "map": {"version":3,"sources":["file:///Users/bashirmuhammadjibrin/Documents/uniteBank/app/api/transfers/name-enquiry/route.ts"],"sourcesContent":["import { NextRequest } from 'next/server';\nimport { adminStorage } from '@server/admin-storage';\nimport { z } from 'zod';\n\nconst enquirySchema = z.object({\n    accountNumber: z.string().min(10),\n});\n\nexport async function GET(request: NextRequest) {\n    try {\n        const { searchParams } = new URL(request.url);\n        const accountNumber = searchParams.get('accountNumber');\n\n        if (!accountNumber) {\n            return Response.json({ message: \"Account number is required\" }, { status: 400 });\n        }\n\n        const validation = enquirySchema.safeParse({ accountNumber });\n        if (!validation.success) {\n            return Response.json({ message: \"Invalid account number format\" }, { status: 400 });\n        }\n\n        const user = await adminStorage.getUserByAccountNumber(accountNumber);\n\n        if (!user) {\n            return Response.json({ message: \"Account not found\" }, { status: 404 });\n        }\n\n        // Return only non-sensitive info\n        return Response.json({\n            firstName: user.firstName,\n            lastName: user.lastName,\n            accountNumber: user.accountNumber,\n        });\n    } catch (err: any) {\n        console.error(\"Name enquiry error:\", err);\n        return Response.json({ message: \"Internal server error\" }, { status: 500 });\n    }\n}\n"],"names":[],"mappings":";;;;AACA;AACA;;;AAEA,MAAM,gBAAgB,qKAAC,CAAC,MAAM,CAAC;IAC3B,eAAe,qKAAC,CAAC,MAAM,GAAG,GAAG,CAAC;AAClC;AAEO,eAAe,IAAI,OAAoB;IAC1C,IAAI;QACA,MAAM,EAAE,YAAY,EAAE,GAAG,IAAI,IAAI,QAAQ,GAAG;QAC5C,MAAM,gBAAgB,aAAa,GAAG,CAAC;QAEvC,IAAI,CAAC,eAAe;YAChB,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;YAA6B,GAAG;gBAAE,QAAQ;YAAI;QAClF;QAEA,MAAM,aAAa,cAAc,SAAS,CAAC;YAAE;QAAc;QAC3D,IAAI,CAAC,WAAW,OAAO,EAAE;YACrB,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;YAAgC,GAAG;gBAAE,QAAQ;YAAI;QACrF;QAEA,MAAM,OAAO,MAAM,sKAAY,CAAC,sBAAsB,CAAC;QAEvD,IAAI,CAAC,MAAM;YACP,OAAO,SAAS,IAAI,CAAC;gBAAE,SAAS;YAAoB,GAAG;gBAAE,QAAQ;YAAI;QACzE;QAEA,iCAAiC;QACjC,OAAO,SAAS,IAAI,CAAC;YACjB,WAAW,KAAK,SAAS;YACzB,UAAU,KAAK,QAAQ;YACvB,eAAe,KAAK,aAAa;QACrC;IACJ,EAAE,OAAO,KAAU;QACf,QAAQ,KAAK,CAAC,uBAAuB;QACrC,OAAO,SAAS,IAAI,CAAC;YAAE,SAAS;QAAwB,GAAG;YAAE,QAAQ;QAAI;IAC7E;AACJ"}}]
}