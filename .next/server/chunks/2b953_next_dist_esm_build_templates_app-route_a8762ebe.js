module.exports=[75606,e=>{"use strict";var t=e.i(30469),a=e.i(6373),r=e.i(29291),s=e.i(56429),n=e.i(49252),i=e.i(21595),o=e.i(92134),d=e.i(7009),u=e.i(83090),c=e.i(26994),l=e.i(34461),p=e.i(69746),_=e.i(85539),m=e.i(73963),f=e.i(69848),y=e.i(93695);e.i(58584);var h=e.i(8219),w=e.i(49362),g=e.i(54799);function b(e){let t={};for(let a in e)e.hasOwnProperty(a)&&(t[a.replace(/_([a-z])/g,e=>e[1].toUpperCase())]=e[a]);return t}function R(e){let t={};for(let a in e)e.hasOwnProperty(a)&&(t[a.replace(/[A-Z]/g,e=>`_${e.toLowerCase()}`)]=e[a]);return t}(0,e.i(24361).promisify)(g.scrypt);let E=new class{async getUser(e){let{data:t,error:a}=await w.supabase.from("users").select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).eq("id",e).single();if(a)throw a;if(t)return b(t)}async getUserByEmail(e){let{data:t,error:a}=await w.supabase.from("users").select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).eq("email",e).single();if(a)throw a;if(t)return b(t)}async createUser(e){let t=R(e),{data:a,error:r}=await w.supabase.from("users").insert([t]).select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).single();if(r)throw r;if(a)return b(a);throw Error("User creation failed")}async updateUserStatus(e,t){let{data:a,error:r}=await w.supabase.from("users").update({status:t}).eq("id",e).select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).single();if(r)throw r;if(a)return b(a)}async updateUserBalance(e,t){let{data:a,error:r}=await w.supabase.from("users").update({balance:t}).eq("id",e).select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).single();if(r)throw r;if(a)return b(a)}async updateUserAccountNumber(e,t){let{data:a,error:r}=await w.supabase.from("users").update({account_number:t}).eq("id",e).select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).single();if(r)throw r;if(a)return b(a)}async verifyUserEmail(e){let{error:t}=await w.supabase.from("users").update({isEmailVerified:!0}).eq("email",e);if(t)throw t}async updateUserPassword(e,t){let{error:a}=await w.supabase.from("users").update({password:t}).eq("id",e);if(a)throw a}async getUserByAccountNumber(e){let{data:t,error:a}=await w.supabase.from("users").select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).eq("account_number",e).single();if(a)throw a;if(t)return b(t)}async getAllUsers(){let{data:e,error:t}=await w.supabase.from("users").select(`
        id,
        first_name,
        last_name,
        other_name,
        email,
        phone,
        dob,
        gender,
        nationality,
        address,
        city,
        state,
        country,
        zip_code,
        id_type,
        id_number,
        id_expiry_date,
        id_image_url,
        selfie_url,
        account_type,
        currency,
        account_purpose,
        password,
        transaction_pin,
        role,
        status,
        "isEmailVerified",
        account_number,
        customer_id,
        balance,
        created_at
      `).order("created_at",{ascending:!1});if(t)throw t;return e?.map(b)||[]}async createOtp(e,t,a="EMAIL_VERIFICATION"){await w.supabase.from("otps").delete().match({email:e});let r=new Date(Date.now()+3e5),{error:s}=await w.supabase.from("otps").insert([{email:e,code:t,purpose:a,expires_at:r.toISOString()}]);if(s)throw s}async verifyOtp(e,t,a="EMAIL_VERIFICATION"){let{data:r,error:s}=await w.supabase.from("otps").select(`
        id,
        email,
        code,
        purpose,
        expires_at
      `).match({email:e,code:t,purpose:a}).single();return!s&&!!r&&(new Date>new Date(r.expires_at)?(await w.supabase.from("otps").delete().eq("id",r.id),!1):(await w.supabase.from("otps").delete().eq("id",r.id),!0))}async createTransaction(e){let t=R(e),{data:a,error:r}=await w.supabase.from("transactions").insert([t]).select(`
        id,
        user_id,
        type,
        amount,
        description,
        created_by,
        created_at
      `).single();if(r)throw r;if(a)return b(a);throw Error("Transaction creation failed")}async getTransactionsByUserId(e){let{data:t,error:a}=await w.supabase.from("transactions").select(`
        id,
        user_id,
        type,
        amount,
        description,
        created_by,
        created_at
      `).eq("user_id",e).order("created_at",{ascending:!1});if(a)throw a;return t?.map(b)||[]}async getAllTransactions(){let{data:e,error:t}=await w.supabase.from("transactions").select(`
        id,
        user_id,
        type,
        amount,
        description,
        created_by,
        created_at
      `).order("created_at",{ascending:!1});if(t)throw t;return e?.map(b)||[]}async createTransfer(e){let t=R(e),{data:a,error:r}=await w.supabase.from("transfers").insert([t]).select(`
        id,
        sender_id,
        recipient_id,
        amount,
        description,
        status,
        admin_note,
        approved_by,
        created_at,
        processed_at
      `).single();if(r)throw r;if(a)return b(a);throw Error("Transfer creation failed")}async getTransfersByUserId(e){let{data:t,error:a}=await w.supabase.from("transfers").select(`
        id,
        sender_id,
        recipient_id,
        amount,
        description,
        status,
        admin_note,
        approved_by,
        created_at,
        processed_at
      `).or(`sender_id.eq.${e},recipient_id.eq.${e}`).order("created_at",{ascending:!1});if(a)throw a;return t?.map(b)||[]}};var v=e.i(26242),x=e.i(84726),A=e.i(73554);let C=x.z.object({recipientAccountNumber:x.z.string().min(10),amount:x.z.number().positive(),description:x.z.string().optional()});async function T(e){try{let t=await (0,A.getCurrentUserFromRequest)(e);if(!t)return Response.json({message:"Unauthorized"},{status:401});let a=await e.json(),r=C.safeParse(a);if(!r.success)return Response.json({message:"Invalid input",errors:r.error.errors},{status:400});let{recipientAccountNumber:s,amount:n,description:i}=r.data;if("APPROVED"!==t.status)return Response.json({message:"Account not approved"},{status:403});if(parseFloat(t.balance)<n)return Response.json({message:"Insufficient funds"},{status:400});let o=await v.adminStorage.getUserByAccountNumber(s);if(!o)return Response.json({message:"Recipient not found"},{status:404});if(t.id===o.id)return Response.json({message:"Cannot transfer to self"},{status:400});let d=await E.createTransfer({sender_id:t.id,recipient_id:o.id,amount:n.toString(),description:i||"Transfer",status:"PENDING"});return Response.json({message:"Transfer request created",transfer:d},{status:201})}catch(e){return console.error("Transfer request error:",e),Response.json({message:"Internal server error"},{status:500})}}e.s(["POST",()=>T],23596);var U=e.i(23596);let N=new t.AppRouteRouteModule({definition:{kind:a.RouteKind.APP_ROUTE,page:"/api/transfers/route",pathname:"/api/transfers",filename:"route",bundlePath:""},distDir:".next",relativeProjectDir:"",resolvedPagePath:"[project]/Documents/uniteBank/app/api/transfers/route.ts",nextConfigOutput:"",userland:U}),{workAsyncStorage:P,workUnitAsyncStorage:q,serverHooks:I}=N;function O(){return(0,r.patchFetch)({workAsyncStorage:P,workUnitAsyncStorage:q})}async function S(e,t,r){N.isDev&&(0,s.addRequestMeta)(e,"devRequestTimingInternalsEnd",process.hrtime.bigint());let w="/api/transfers/route";w=w.replace(/\/index$/,"")||"/";let g=await N.prepare(e,t,{srcPage:w,multiZoneDraftMode:!1});if(!g)return t.statusCode=400,t.end("Bad Request"),null==r.waitUntil||r.waitUntil.call(r,Promise.resolve()),null;let{buildId:b,params:R,nextConfig:E,parsedUrl:v,isDraftMode:x,prerenderManifest:A,routerServerContext:C,isOnDemandRevalidate:T,revalidateOnlyGenerated:U,resolvedPathname:P,clientReferenceManifest:q,serverActionsManifest:I}=g,O=(0,o.normalizeAppPath)(w),S=!!(A.dynamicRoutes[O]||A.routes[P]),D=async()=>((null==C?void 0:C.render404)?await C.render404(e,t,v,!1):t.end("This page could not be found"),null);if(S&&!x){let e=!!A.routes[P],t=A.dynamicRoutes[O];if(t&&!1===t.fallback&&!e){if(E.experimental.adapterPath)return await D();throw new y.NoFallbackError}}let j=null;!S||N.isDev||x||(j="/index"===(j=P)?"/":j);let H=!0===N.isDev||!S,z=S&&!H;I&&q&&(0,i.setManifestsSingleton)({page:w,clientReferenceManifest:q,serverActionsManifest:I});let V=e.method||"GET",k=(0,n.getTracer)(),M=k.getActiveScopeSpan(),B={params:R,prerenderManifest:A,renderOpts:{experimental:{authInterrupts:!!E.experimental.authInterrupts},cacheComponents:!!E.cacheComponents,supportsDynamicResponse:H,incrementalCache:(0,s.getRequestMeta)(e,"incrementalCache"),cacheLifeProfiles:E.cacheLife,waitUntil:r.waitUntil,onClose:e=>{t.on("close",e)},onAfterTaskError:void 0,onInstrumentationRequestError:(t,a,r,s)=>N.onRequestError(e,t,r,s,C)},sharedContext:{buildId:b}},F=new d.NodeNextRequest(e),$=new d.NodeNextResponse(t),K=u.NextRequestAdapter.fromNodeNextRequest(F,(0,u.signalFromNodeResponse)(t));try{let i=async e=>N.handle(K,B).finally(()=>{if(!e)return;e.setAttributes({"http.status_code":t.statusCode,"next.rsc":!1});let a=k.getRootSpanAttributes();if(!a)return;if(a.get("next.span_type")!==c.BaseServerSpan.handleRequest)return void console.warn(`Unexpected root span type '${a.get("next.span_type")}'. Please report this Next.js issue https://github.com/vercel/next.js`);let r=a.get("next.route");if(r){let t=`${V} ${r}`;e.setAttributes({"next.route":r,"http.route":r,"next.span_name":t}),e.updateName(t)}else e.updateName(`${V} ${w}`)}),o=!!(0,s.getRequestMeta)(e,"minimalMode"),d=async s=>{var n,d;let u=async({previousCacheEntry:a})=>{try{if(!o&&T&&U&&!a)return t.statusCode=404,t.setHeader("x-nextjs-cache","REVALIDATED"),t.end("This page could not be found"),null;let n=await i(s);e.fetchMetrics=B.renderOpts.fetchMetrics;let d=B.renderOpts.pendingWaitUntil;d&&r.waitUntil&&(r.waitUntil(d),d=void 0);let u=B.renderOpts.collectedTags;if(!S)return await (0,p.sendResponse)(F,$,n,B.renderOpts.pendingWaitUntil),null;{let e=await n.blob(),t=(0,_.toNodeOutgoingHttpHeaders)(n.headers);u&&(t[f.NEXT_CACHE_TAGS_HEADER]=u),!t["content-type"]&&e.type&&(t["content-type"]=e.type);let a=void 0!==B.renderOpts.collectedRevalidate&&!(B.renderOpts.collectedRevalidate>=f.INFINITE_CACHE)&&B.renderOpts.collectedRevalidate,r=void 0===B.renderOpts.collectedExpire||B.renderOpts.collectedExpire>=f.INFINITE_CACHE?void 0:B.renderOpts.collectedExpire;return{value:{kind:h.CachedRouteKind.APP_ROUTE,status:n.status,body:Buffer.from(await e.arrayBuffer()),headers:t},cacheControl:{revalidate:a,expire:r}}}}catch(t){throw(null==a?void 0:a.isStale)&&await N.onRequestError(e,t,{routerKind:"App Router",routePath:w,routeType:"route",revalidateReason:(0,l.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:T})},!1,C),t}},c=await N.handleResponse({req:e,nextConfig:E,cacheKey:j,routeKind:a.RouteKind.APP_ROUTE,isFallback:!1,prerenderManifest:A,isRoutePPREnabled:!1,isOnDemandRevalidate:T,revalidateOnlyGenerated:U,responseGenerator:u,waitUntil:r.waitUntil,isMinimalMode:o});if(!S)return null;if((null==c||null==(n=c.value)?void 0:n.kind)!==h.CachedRouteKind.APP_ROUTE)throw Object.defineProperty(Error(`Invariant: app-route received invalid cache entry ${null==c||null==(d=c.value)?void 0:d.kind}`),"__NEXT_ERROR_CODE",{value:"E701",enumerable:!1,configurable:!0});o||t.setHeader("x-nextjs-cache",T?"REVALIDATED":c.isMiss?"MISS":c.isStale?"STALE":"HIT"),x&&t.setHeader("Cache-Control","private, no-cache, no-store, max-age=0, must-revalidate");let y=(0,_.fromNodeOutgoingHttpHeaders)(c.value.headers);return o&&S||y.delete(f.NEXT_CACHE_TAGS_HEADER),!c.cacheControl||t.getHeader("Cache-Control")||y.get("Cache-Control")||y.set("Cache-Control",(0,m.getCacheControlHeader)(c.cacheControl)),await (0,p.sendResponse)(F,$,new Response(c.value.body,{headers:y,status:c.value.status||200})),null};M?await d(M):await k.withPropagatedContext(e.headers,()=>k.trace(c.BaseServerSpan.handleRequest,{spanName:`${V} ${w}`,kind:n.SpanKind.SERVER,attributes:{"http.method":V,"http.target":e.url}},d))}catch(t){if(t instanceof y.NoFallbackError||await N.onRequestError(e,t,{routerKind:"App Router",routePath:O,routeType:"route",revalidateReason:(0,l.getRevalidateReason)({isStaticGeneration:z,isOnDemandRevalidate:T})},!1,C),S)throw t;return await (0,p.sendResponse)(F,$,new Response(null,{status:500})),null}}e.s(["handler",()=>S,"patchFetch",()=>O,"routeModule",()=>N,"serverHooks",()=>I,"workAsyncStorage",()=>P,"workUnitAsyncStorage",()=>q],75606)}];

//# sourceMappingURL=2b953_next_dist_esm_build_templates_app-route_a8762ebe.js.map